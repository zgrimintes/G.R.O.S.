using JetBrains.Annotations;
using System.Collections;
using System.Collections.Generic;
using TMPro;
using UnityEngine;
using UnityEngine.UIElements;

public class Fighter : Collidable
{
    public int dmg = 1;
    public float ImmuneTime;
    protected float lastImmune;
    protected Vector3 chargeD;

    public float cooldown_hit;
    private float last_hit;

    private bool hit;

    protected override void Update()
    {
        base.Update();

        if (Input.GetKey(KeyCode.Space))
        {
            if (Time.time - last_hit > cooldown_hit) //If the cooldown is ready
            {
                last_hit = Time.time;
                Hit();
            }
        }
    }

    protected virtual void Hit()
    {
        gameObject.GetComponent<Charge>().StartCharging(); //Start corutine for charging from the Charging script
    }

    protected override void OnCollide(Collider2D coll)
    {
        if (coll.tag == "Fighter" && hit) //Get hit only if the target is a fighter
            if (Time.time - lastImmune > ImmuneTime)
            {
                lastImmune = Time.time;
                //send dmg message
                coll.SendMessage("TakeDmg", dmg);
                hit = false;
            }
    }
}
